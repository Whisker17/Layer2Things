# State Channel

## Content

- [**简述**](#简述)
- [**优点和缺点**](#优点和缺点)
- [**代表性项目**](#代表性项目)

### 简述

- 一般情况下是双方会在链下建立一个状态通道，通过**交换私钥进行签名以后的信息**，并在链下进行交易。

  基本上，**状态通道的延迟能做到互联网的延迟**。比如说服务器之间的延迟是多少，这个状态通道的延迟就是多少。市面上通过其他链发送交易的速度是秒级的。但是状态通道的话，一般都是毫秒级的。另外，它还有一个优点就是**实时性非常高**。

  状态通道是一种**scale up（扩容）**的手段。scale up 的意思是用技术手段线性地将区块链扩容，比如说像**分片**。比如说以太坊 2.0 要启动 64 个分片，然后它的容量就增加了 64 倍。而对于状态通道来说，他现在能支持 1000 个用户同时在线，未来可能最多支持到 64000 个用户，这个数字还是很低的。

  尽管状态通道的 scale up 是说你节点数量越多，你的网络越大，你的容量越大。这只是一个很美好的设想，实际上它受到了一个很大的**限制**——**low liquidity utilization（低资金利用率）**。**状态通道是要这个双方都把这个钱存到链上的通道，之后再互相进行发送支付**。第一步，就是要把钱存到链上去，这个钱是有限的。就是你比如说手上你有 1000 个以太，状态通道只能发送 1000 个以太。如果你突然发送一笔 2000 以上的以太，它就无能为力了。

  因为容量可以扩容，然而资金流动性却没有办法扩容。**如果一个用户给另一个用户发送一大笔钱，那中间每一个转发的节点都要有这么大的容量，在现实生活中是不太可能的**。等大家把这么多钱都锁到一个状态通道里边，如果只能用状态通道转发的话，这个效率是非常低下。

  状态通道只能支持**小额支付**。像闪电网络其实并不大，可能和资金利用率低是有关系的。另外，把一般的dAPP搬到状态通道是相当难的。

  另外，**状态机只适用于这个固定的人数**。就是你要把 uniswap 放在状态机上是不现实的。因为在这个dAPP 的用户是无限量的，没有一个固定的用户集。即使你把棋类游戏或是稍大的 PC 游戏搬到状态通道上，这些游戏也必须写成状态机的形式。**他们每一个状态的转移，要非常清楚地写出来**。

  理论上，你可以把任意单机游戏都搬到状态通道上。但现实中没有人会去这样做，除非你是非常不信任游戏服务器。一般来说，预测市场以及赌球赛马（大家对及时变化很快的场景做预测），是可以搬到状态通道上的。

- 状态通道技术，受启发于比特币的闪电网络。**状态通道是固定一组参与者（通常是两名参与者）之间的协议，用以实现安全的链下交易，其中支付通道专门用来支付**。支付通道协议具体情况是两名参与者各自通过链上交易在链上锁定保证金，一旦锁定完成，参与者双方即可互相发送形式为轮次、金额、签名的状态更新来实现转账，**无需与主链进行交互**，只要双方的余额都还为正值即可。一旦参与者中有一方想要停止使用支付通道，可以执行「退出」操作：将最后的状态更新提交至主链，结算下来的余额会退给发起支付通道的两方。主链可以通过核实签名和最后结余来验证状态更新的有效性，从而防止参与者使用无效状态来退出支付通道。**状态通道带来的优点是交互延迟在毫秒级别，是唯一能够逼近当今互联网用户体验的区块链扩容技术**；**交易手续费极低**，从根本上比所有其他 layer2 技术的交易手续费低；**水平扩展性强**，加节点就能增加总系统容量，TPS 无上限，且互相之间不隔离，不需要有跨分片或者跨链之类的复杂操作。但它的「退出」模式存在一个问题，**即主链无法验证支付通道是否提交了全部交易，也就是说，在提交了状态更新之后是否不再出现新的状态更新**。此外，状态通道的另一个缺点是只能在两个参与者之间开设。

### 优点和缺点

- **优点**
  1. 延迟低，实时性高
- **缺点**
  1. 用户人数有限，资金利用率低

### 代表项目

- **Celer Network**

  Celer Network 是第一个致力于以状态通道技术为基石构建匹配互联网规模的区块链应用入口平台，让所有人都能够在该平台上便捷快速地开发、运行与使用高性能的分布式区块链应用。它并不是一个独立的区块链，而是一个可以广泛运行在现有和未来区块链之上的网络系统。Celer 以其在链下扩容技术和加密经济学上的创新为区块链平台提供了前所未有的高性能和灵活性。