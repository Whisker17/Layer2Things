# ZK Rollup

## Content

- [**简述**](#简述)
- [**优点和缺点**](#优点和缺点)
- [**代表性项目**](#代表性项目)

### 简述

- ZK Rollup 是靠着在**主链完成零知识证明**，**链上无需包含签名数据**，因为零知识证明就足以证明交易的有效与否，交易有效性就立刻确认，**保证无效的状态绝不会发生**，也即**数据可用性放在链上**，所以 ZK Rollups **对数据存储方面也带来了一定程度上的扩展性提升**。但由于零知识证明生成的复杂性，目前适合简单的转账。它的缺点是**验证链路的构造没有一个通用的解决方案**，所以目前没有很好的办法做到很广义的虚拟机逻辑，简单来说，zk-Rollup 必须对每一个用例定制；程序正确性的验证相对复杂，要对多项式 curcuit 做验证；**二层打包节点负担重，成本高，计算零知识证明所需时间长，用户延迟的体验角度仍然比较差**。

- 一个类似于 Plasma 的架构，并可「打包」交易，它无需依赖于对运营商的信任，打包的正确性可以通过使用一个 **SNARK 的链上证据来证明**。

  此 SNARK 确保运营商不可能发布恶意或无效的事务，并确保所有侧链区块都是有效的。

  将交易数据作为函数参数发布意味着**可以在发布时对其进行验证**，随后将其丢弃，这样就不会占据以太坊的存储空间。ZK Rollup 可以在不牺牲可负担性或安全性的情况下，避免 Plasma 的退出游戏和挑战期。

  **生成有效性证明在计算上很昂贵**。这些 zk-SNARK 会在每个区块生成，生成时间可能长达 10 分钟，而每次验证的成本高达 350,000 gas （伊斯坦布尔升级后） ，这大约占整个区块的 3.5% （在伊斯坦布尔升级前占到了 8%） 。

- ZK-Rollups 是为 layer2 构建而开发的选项之一，可通过将大量交易 Rollup 到单个交易中来提高可伸缩性。  Plasma 每次交易创建一个交易，而 ZK-Rollups 将数百个交易 Rollup 为一个交易。 智能合约将解构并验证一笔 Rollup 交易中所有的交易。

  使用“零知识证明”方法在以太坊区块链上呈现并公开记录该区块的有效性。 ZK 通过减少交易中保存的数据量来减少用于验证块的计算和存储资源； 整个数据需要零知识。

- ZK-Rollup 方案包括两种类型的用户：**交易者**和**中继者**。交易者创建交易，并广播到网络。交易数据中包含 “from” 和 “to” 地址的索引，以及交易的量，网络费用和随机数组成。地址的缩短的 3 字节索引版本减少了处理资源需求。交易的值大于或小于零将分别创建存款或提款。智能合约将数据记录在两个 Merkle 树中；一棵 Merkle 树是地址，另一棵是交易额。

  中继器收集大量交易以创建 Rollup 。生成 SNARK 证明是中继器的工作。 SNARK 证明是代表区块链状态增量的哈希值。状态是指“存在状态”。 SNARK 证明将交易之前的区块链快照与交易之后的区块链快照（即钱包值）进行比较，并仅将可验证哈希中的更改报告给主网。

  值得注意的是，只要将智能合约中要求的保证金押入赌注中，任何人都可以成为中继器。这使中继器不能篡改或阻止 Rollup 。

### 优点和缺点

- **优点**
  1. 降低每次用户交易的费用
  2. 比 Plasma 和 Optimistic Rollup 更快
  3. 区块将在鼓励去中心化的并行计算模型中进行计算
  4. 每个交易中包含的数据更少，从而提高了 layer2 的吞吐量和可伸缩性
  5. 不需要像 Optimistic Rollup 那样的欺诈证明，Optimistic Rollup 提款最多可能会延迟两周
- **缺点**
  1. 计算零知识证明的难度将要求数据优化以获取最大吞吐量
  2. ZK-Rollups 的初始设置更倾向于中心化方案
  3. 该安全方案假定不可验证的信任级别
  4. 量子计算对黑客入侵区块链构成威胁

### 代表性项目

- **Loopring**

  **路印协议** 3.0 的核心设计目标包括两个：**高安全性**和**高性能**。协议设计的很多方面，都是围绕着在各种可能的情况下，为用户提现自己充值的资产提供各种保障。这种保障允许用户在极端情况下，仅提供**默克尔证明**，不依靠于交易所的任何动作，就可以将资产全部取出。而默克尔证明，则可以通过区块链上的数据可用性计算得到。为了提高吞吐量，并降低清结算成本，将几乎全部的计算都迁移到区块链外完成。这种计算会更新中继维护的一棵四叉默克尔树，用以保存每个用户每个币种的余额，以及每个订单的成交历史。中继批量处理几十到几万个充值提现和交易清结算等请求，并将批量更新后的树根上链。为了保障中继的计算更新方式严格遵循协议的规则，**中继必须在一定时间内提供批量处理相关的零知识证明**。即将发布的 3.6 版本变成成一个基于订单簿的去中心化交易所的 AMM 协议，将实现 Layer2 账户之间的转账，只需要一秒就能到账；Layer2 账户转到 Layer1 账户，只需要十几秒就能到账。

- **zkSync** 

  zkSync 是 Matter Labs 基于 ZK Rollup 技术开发的免信任型可扩展性和隐私性解决方案，，旨在将以太坊上的吞吐量提高到像 VISA 那样每秒可达几千笔交易，同时又能确保资金像存储在底层账户那样安全，并维持较高水平的抗审查性。该协议的另一个重要方面是延迟性极低：ZK Sync 上的交易具有**即时经济确定性**。

  在实现 ZK Rollup 的**高 TPS** 和**低手续费**的基础指标外，zkSync 建立了一个更加实用和独立的网络：

  - **亚秒级交易确认**。zkSync 引入了**即时交易收据**（Instant TX Receipts）设计，**网络验证人会在对一笔交易形成共识后预先使用质押资金确保这笔交易将被包含在下一个 zkSync 区块之中**；

  - **抗审查**。为了保护网络的隐私性，zkSync 设置了**守护者**（Guardian）的角色，用以**监控验证节点见的点对点通信流量和探测审查行为，守护者可以频繁更换一部分验证者**。

  - 零知识智能合约框架。zkSync 推出了安全且高效的编程框架和基于虚拟机的运行环境 Zinc，为基于零知识证明的智能合约而设计，可以将 Layer1 上的智能合约快速编译为零知识证明算法善于处理的程序，**以此作为 Layer1 上 DeFi 等大量消耗资源的应用转移到 Layer2 的桥梁**。但由于零知识证明本身过于复杂，安全性仍然需要大量尝试验证。

- **Aztec** 

  Aztec 的目标是**在以太坊基础上建立一个 UTXO 层**、使用零知识证明来提升交易的隐私性。这个项目使用一个公开的、大规模的多方计算（MPC）仪式来完成可信任初始化工作（trusted setup），并且开发了 zk.money 来让社区尝试他们的产品，并将隐私增强型技术和 zk Rollup 技术栈结合在一起，打造 ZK² Rollup。

  

  
